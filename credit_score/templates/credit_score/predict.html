{% extends 'base.html' %}
{% load static %}
{% load credit_app_extras %} {# Убедитесь, что ваш get_item фильтр доступен здесь #}

{% block title %}Одобрение кредита{% endblock %}

{% block extra_css %}
    {# Используем доработанные стили на основе вашего примера #}
    <link rel="stylesheet" href="{% static 'credit_score/styles.css' %}">
{% endblock %}

{% block content %}
<div class="container-form">
    <h1>Прогноз одобрения кредита</h1>

    <form method="post">
        {% csrf_token %}

        <div class="form-group">
            <label for="client_id">Выбрать существующего клиента:</label>
            <select id="client_id" name="client_id" onchange="this.form.submit()">
                <option value="None">-- Ввести данные вручную --</option>
                {% for client in clients %}
                    <option value="{{ client.id }}" {% if selected_client_id|floatformat:"0" == client.id|floatformat:"0" %}selected{% endif %}>
                        {{ client.full_name }} (ID: {{ client.id }})
                    </option>
                {% endfor %}
            </select>
        </div>

        {% if client_info %}
            <div class="client-info">
                <h3>Данные выбранного клиента ({{ client_info.full_name }}):</h3>
                <ul>
                    <li>Возраст: {{ client_info.age }}</li>
                    <li>Ежемесячный доход: {{ client_info.monthly_income }}</li>
                    <li>Коэффициент долговой нагрузки: {{ client_info.debt_ratio }}</li>
                    <li>Процент использования кредита: {{ client_info.utilization }}</li>
                    <li>Количество просрочек (30-59 дней): {{ client_info.num_30_59_days_past_due }}</li>
                    <li>Количество кредитных линий/займов: {{ client_info.num_credit_lines_loans }}</li>
                </ul>
            </div>
        {% else %}
            {% for feature in features %}
                <div class="form-group">
                    <label for="{{ feature }}">
                        {{ feature_names_ru|get_item:feature }} (<span class="feature-name">{{ feature }}</span>):
                    </label>
                    <input type="number" id="{{ feature }}" name="{{ feature }}" step="0.01"
                           value="{{ initial_data|get_item:feature|default:'0' }}" required>
                </div>
            {% endfor %}
        {% endif %}

        <button type="submit">Получить прогноз</button>
    </form>

    {% if prediction %}
        <div class="prediction-result
            {% if prediction == 'Одобрен' %}approved{% elif prediction == 'Отклонен' %}declined{% else %}error{% endif %}">
            <p>Результат прогноза: <strong>{{ prediction }}</strong></p>
        </div>
    {% endif %}

</div>
{% endblock %}